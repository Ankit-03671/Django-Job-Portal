{% extends 'base.html' %}
{% block title %}My Profile - Job Portal{% endblock %}

{% block content %}
<h1>My Profile</h1>

<div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; margin-bottom: 2rem;">
    <!-- Profile Picture Section -->
    <div style="text-align: center;">
        {% if profile.profile_picture %}
            <img src="{{ profile.profile_picture.url }}" alt="Profile Picture" 
                 style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid #007bff;">
        {% else %}
            <div style="width: 150px; height: 150px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; margin: 0 auto; font-size: 3rem;">
                ðŸ‘¤
            </div>
        {% endif %}
        <h3 style="margin-top: 1rem;">{{ user.get_full_name|default:user.username }}</h3>
        <p style="color: #666;">{{ profile.get_user_type_display }}</p>
    </div>
    
    <!-- Quick Info -->
    <div>
        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
            <h4>Quick Info</h4>
            <p><strong>Email:</strong> {{ user.email }}</p>
            <p><strong>Phone:</strong> {{ profile.phone|default:"Not provided" }}</p>
            <p><strong>Location:</strong> {{ profile.location|default:"Not provided" }}</p>
            {% if profile.company %}
                <p><strong>Company:</strong> {{ profile.company }}</p>
            {% endif %}
            {% if profile.website %}
                <p><strong>Website:</strong> <a href="{{ profile.website }}" target="_blank">{{ profile.website }}</a></p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Profile Form -->
<form id="profileForm" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <div>
            <label>First Name</label>
            <input type="text" name="first_name" value="{{ user.first_name }}" placeholder="First Name">
        </div>
        <div>
            <label>Last Name</label>
            <input type="text" name="last_name" value="{{ user.last_name }}" placeholder="Last Name">
        </div>
    </div>
    
    <label>Email</label>
    <input type="email" name="email" value="{{ user.email }}" required>
    
    <label>User Type</label>
    <select name="user_type" style="width: 100%; padding: 1rem; border: 2px solid #e1e5e9; border-radius: 8px; margin-bottom: 1.5rem;">
        <option value="seeker" {% if profile.user_type == 'seeker' %}selected{% endif %}>Job Seeker</option>
        <option value="employer" {% if profile.user_type == 'employer' %}selected{% endif %}>Employer</option>
    </select>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <div>
            <label>Phone</label>
            <input type="tel" name="phone" value="{{ profile.phone }}" placeholder="Phone Number">
        </div>
        <div>
            <label>Location</label>
            <input type="text" name="location" value="{{ profile.location }}" placeholder="City, Country">
        </div>
    </div>
    
    <label>Bio</label>
    <textarea name="bio" rows="4" placeholder="Tell us about yourself...">{{ profile.bio }}</textarea>
    
    <div id="seekerFields" style="{% if profile.user_type == 'employer' %}display: none;{% endif %}">
        <label>Skills (comma-separated)</label>
        <input type="text" name="skills" value="{{ profile.skills }}" placeholder="Python, JavaScript, Django...">
        
        <label>Experience Level</label>
        <select name="experience" style="width: 100%; padding: 1rem; border: 2px solid #e1e5e9; border-radius: 8px; margin-bottom: 1.5rem;">
            <option value="">Select Experience</option>
            <option value="entry" {% if profile.experience == 'entry' %}selected{% endif %}>Entry Level (0-2 years)</option>
            <option value="mid" {% if profile.experience == 'mid' %}selected{% endif %}>Mid Level (2-5 years)</option>
            <option value="senior" {% if profile.experience == 'senior' %}selected{% endif %}>Senior Level (5+ years)</option>
        </select>
    </div>
    
    <div id="employerFields" style="{% if profile.user_type == 'seeker' %}display: none;{% endif %}">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div>
                <label>Company Name</label>
                <input type="text" name="company" value="{{ profile.company }}" placeholder="Company Name">
            </div>
            <div>
                <label>Website</label>
                <input type="url" name="website" value="{{ profile.website }}" placeholder="https://company.com">
            </div>
        </div>
    </div>
    
    <label>Profile Picture</label>
    <input type="file" name="profile_picture" accept="image/*" 
           style="padding: 0.8rem; border: 2px dashed #007bff; border-radius: 8px; width: 100%; margin-bottom: 1.5rem;">
    
    <button type="submit">Update Profile</button>
</form>
{% endblock %}

{% block scripts %}
<script>
// Toggle fields based on user type
document.querySelector('[name="user_type"]').addEventListener('change', function() {
    const seekerFields = document.getElementById('seekerFields');
    const employerFields = document.getElementById('employerFields');
    
    if (this.value === 'seeker') {
        seekerFields.style.display = 'block';
        employerFields.style.display = 'none';
    } else {
        seekerFields.style.display = 'none';
        employerFields.style.display = 'block';
    }
});

// Profile picture preview
document.querySelector('[name="profile_picture"]').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = document.querySelector('img');
            if (img) {
                img.src = e.target.result;
            }
        };
        reader.readAsDataURL(file);
    }
});

document.getElementById('profileForm').addEventListener('submit', function() {
    showLoading();
});
</script>
{% endblock %}